# 🔐 密码自动加密/解密功能说明

## ✨ 功能概述

本应用已集成了**端到端加密**功能，您的密码在存储到区块链之前会自动加密，只有您本人可以解密查看。

---

## 🔑 加密原理

### 1. 密钥生成

- 使用您的**钱包签名**生成唯一的加密密钥
- 每个钱包地址生成的密钥都是唯一的
- 密钥不会被存储，每次都通过签名重新生成

### 2. 加密算法

- **算法**: AES-GCM (256位)
- **安全性**: 军用级加密标准
- **随机IV**: 每次加密使用不同的初始化向量

### 3. 数据流程

```
明文密码 → 钱包签名 → 生成密钥 → AES加密 → 上链存储
         ↓
链上数据 → 钱包签名 → 生成密钥 → AES解密 → 明文显示
```

---

## 📖 使用说明

### 添加密码

1. **填写表单**
   - 密码名称：如"邮箱密码"
   - 密码：输入您的实际密码（明文）
   - 分类：如"邮箱"、"金融"
   - 描述：可选

2. **签名授权**
   - 点击"添加密码"
   - 钱包会弹出签名请求（首次使用）
   - 签名消息：`签名此消息以生成您的密码加密密钥...`
   - **重要**：这个签名不会花费Gas费

3. **自动加密**
   - 密码会自动使用AES-256加密
   - 加密后的数据存储到区块链
   - 只有您能用相同的钱包解密

4. **完成**
   - 密码添加成功
   - 列表中显示密码条目

### 查看/编辑密码

1. **打开密码**
   - 在列表中点击任意密码条目
   - 或点击"编辑"按钮

2. **自动解密**
   - 应用会自动解密密码
   - 默认以 `******` 形式显示

3. **显示密码**
   - 点击 👁️ 图标查看明文
   - 再次点击 🙈 图标隐藏

4. **复制密码**
   - 点击 📋 图标
   - 密码自动复制到剪贴板
   - 无需手动选择

5. **编辑密码**
   - 修改任何字段
   - 点击"更新密码"
   - 密码会重新加密后保存

---

## 🔒 安全特性

### ✅ 您的密码是安全的

1. **端到端加密**
   - 密码在浏览器中加密
   - 服务器/区块链只存储密文
   - 只有您能解密

2. **钱包绑定**
   - 密钥与您的钱包地址绑定
   - 其他人无法解密您的密码
   - 即使他们获得了加密数据

3. **不存储密钥**
   - 密钥只在内存中
   - 刷新页面后密钥消失
   - 每次需要时重新生成

4. **区块链特性**
   - 数据永久存储
   - 不可篡改
   - 去中心化

### ⚠️ 安全提示

1. **保管好您的私钥**
   - 私钥丢失 = 密码永久丢失
   - 私钥泄露 = 密码可能被解密
   - 使用硬件钱包更安全

2. **签名请求**
   - 首次加密/解密需要签名
   - 签名不花费Gas费
   - 不要在不信任的网站签名

3. **网络安全**
   - 使用HTTPS连接
   - 不要在公共WiFi使用
   - 定期更新浏览器

4. **备份策略**
   - 导出钱包助记词
   - 保存在安全的地方
   - 不要截图或发送给任何人

---

## 💡 常见问题

### Q1: 为什么要签名？

**A:** 签名用于生成加密密钥。这是一个确定性的过程，同一个钱包的同一个消息总是生成相同的密钥。这样您可以在不同设备上解密密码。

**签名特点：**
- ✅ 不花费Gas费
- ✅ 不会泄露私钥
- ✅ 安全可靠

---

### Q2: 换设备后能访问密码吗？

**A:** 可以！只要：
1. 使用相同的钱包地址
2. 连接到相同的网络（XLayer）
3. 签名相同的消息

您的密码会自动解密显示。

---

### Q3: 别人能看到我的密码吗？

**A:** 不能！
- 区块链上只存储加密后的数据
- 没有您的钱包私钥，无法解密
- 即使是合约所有者也无法查看

---

### Q4: 密钥会被保存吗？

**A:** 不会！
- 密钥只在浏览器内存中
- 刷新页面后消失
- 下次使用时通过签名重新生成

---

### Q5: 加密安全吗？

**A:** 非常安全！
- **AES-256-GCM**: 军用级加密标准
- **唯一密钥**: 每个钱包独立的密钥
- **随机IV**: 每次加密使用不同的向量
- **端到端**: 数据不经过任何第三方

---

### Q6: 私钥丢了怎么办？

**A:** 很遗憾，**无法找回**。
- 密码与钱包地址绑定
- 没有私钥无法生成解密密钥
- 这是去中心化的代价

**预防措施：**
- 备份助记词
- 使用硬件钱包
- 不要保存太重要的密码

---

### Q7: 可以导出密码吗？

**A:** 目前不支持明文导出，因为：
- 为了安全性
- 避免批量泄露风险

**解决方案：**
- 逐个查看并记录
- 使用截图（注意安全）
- 复制到本地密码管理器

---

## 🎯 最佳实践

### 推荐做法 ✅

1. **使用硬件钱包**
   - Ledger / Trezor
   - 更高的安全性

2. **定期备份助记词**
   - 写在纸上
   - 保存在保险箱

3. **分类管理**
   - 重要密码：银行、邮箱
   - 一般密码：论坛、游戏

4. **定期更换密码**
   - 在原系统修改
   - 同步更新到链上

### 避免做法 ❌

1. **不要截图助记词**
   - 可能被云同步
   - 手机丢失风险

2. **不要在公共场所使用**
   - 避免肩窥
   - 避免不安全WiFi

3. **不要保存绝对机密**
   - 银行密码慎重
   - 公司机密不要存

4. **不要分享私钥**
   - 任何情况下都不要
   - 官方不会索要

---

## 🔬 技术细节

### 加密流程

```javascript
// 1. 生成密钥
signature = wallet.signMessage("固定消息")
keyMaterial = SHA256(signature)
key = importKey(keyMaterial, AES-GCM-256)

// 2. 加密数据
iv = randomBytes(12)
ciphertext = AES-GCM.encrypt(key, iv, plaintext)
stored = base64(iv + ciphertext)

// 3. 解密数据
iv = stored[:12]
ciphertext = stored[12:]
plaintext = AES-GCM.decrypt(key, iv, ciphertext)
```

### 存储格式

```
链上数据格式:
- ID: uint256
- Name: string (明文)
- EncryptedPassword: string (base64编码的加密数据)
- Category: string (明文)
- Description: string (明文)
- Timestamps: uint256
```

### 浏览器支持

需要支持：
- ✅ Web Crypto API
- ✅ SubtleCrypto
- ✅ Clipboard API

现代浏览器均支持：
- Chrome 37+
- Firefox 34+
- Safari 11+
- Edge 79+

---

## 📚 相关资源

- [Web Crypto API](https://developer.mozilla.org/en-US/docs/Web/API/Web_Crypto_API)
- [AES-GCM](https://en.wikipedia.org/wiki/Galois/Counter_Mode)
- [钱包安全指南](https://ethereum.org/en/security/)

---

## 🆘 需要帮助？

如果遇到问题：

1. 检查浏览器控制台（F12）
2. 确认钱包已正确连接
3. 确认网络是 XLayer
4. 查看 README-WEB3MODAL.md

---

**记住：您的安全，您负责！** 🔐

